<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Card√°pio Interativo</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Arial,sans-serif;background:#f5f5f5;display:flex;flex-direction:column;align-items:center;padding:10px}
.cardapio{background:#fff;padding:20px;border-radius:12px;box-shadow:0 6px 15px rgba(0,0,0,0.2);max-width:500px;width:100%;margin-bottom:20px}
.logo-container{display:flex;align-items:center;justify-content:flex-start;margin-bottom:20px}
.logo-container img{height:60px;margin-right:15px;border-radius:8px}
.titulo-container h1{font-size:1.5rem;color:#007BFF;margin-bottom:5px}
.titulo-container h2{font-size:1.1rem;color:#555;font-weight:normal}
.titulo-container h3{font-size:1rem;margin-bottom:10px;color:#333}
ul{list-style:none;padding:0}
li{margin:5px 0;cursor:pointer;display:flex;align-items:center;justify-content:space-between;padding:6px 10px;border-radius:8px;transition:background 0.2s}
li:hover{background:#f0f0f0}
.checkbox-fake{width:22px;height:22px;border:2px solid #007BFF;display:flex;align-items:center;justify-content:center;margin-right:10px;border-radius:4px;font-weight:bold;color:#fff;background:#007BFF;opacity:0;transition:opacity 0.2s,transform 0.2s;flex-shrink:0}
li.selected .checkbox-fake{opacity:1;transform:scale(1.1)}
li span{flex:1}
.quantidade-container{display:flex;align-items:center;gap:4px}
.quantidade-container button{width:24px;height:24px;background:#007BFF;color:#fff;border:none;border-radius:4px;font-weight:bold;cursor:pointer}
.quantidade-container input{width:40px;text-align:center;border:1px solid #ccc;border-radius:4px;padding:2px}
#adicionais,#observacao,input[type="text"],select,textarea{width:100%;padding:8px;margin-top:8px;border-radius:6px;border:1px solid #ccc}
#taxaEntregaInfo{margin:12px 0;background:#e8f0fe;border:1px solid #007BFF;color:#007BFF;font-weight:bold;text-align:center;padding:8px;border-radius:8px}
#enviarWhats{margin-top:12px;padding:10px;background:#25D366;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:bold;width:100%;font-size:1rem}
label{display:block;margin-bottom:6px;cursor:pointer}
.marmita-options label{display:block;margin-bottom:8px;cursor:pointer}
.marmita-options input{margin-right:8px}
#adicionarPedido{margin:10px 0;padding:8px;width:100%;border-radius:8px;border:1px solid #007BFF;background:#007BFF;color:#fff;cursor:pointer;font-weight:bold}
.pedido-individual{border:1px solid #ccc;padding:10px;margin:10px 0;border-radius:8px;background:#f9f9f9}
.pedido-individual h4{margin-bottom:5px}
@media(max-width:600px){
.logo-container{flex-direction:column;align-items:center;text-align:center}
.logo-container img{margin-right:0;margin-bottom:8px;height:50px}
.titulo-container h1{font-size:1.3rem}
.titulo-container h2{font-size:1rem}
#enviarWhats,#adicionarPedido{font-size:0.95rem}
}
</style>
</head>
<body>

  <div class="cardapio">
  <div class="logo-container">
    <img src="logo.png" alt="Logo Restaurante">
    <div class="titulo-container">
      <h1>Restaurante Colinas</h1>
      <h2>üçΩÔ∏è Card√°pio de Hoje ‚Äì <span id="diaSemana"></span>, <span id="dataHoje"></span></h2>
      <h3 id="horarioFuncionamento">Hor√°rio: --:-- - --:--</h3>
    </div>
  </div>


 <label>Local de Entrega:</label>
<select id="localEntrega" required>
  <option value="retirada" selected data-taxa="0">üìç Retirada no Local</option>
  <option value="entrega" data-taxa="5">üè† Entrega em Casa</option>
</select>

<div id="enderecoContainer" style="display:none;">
  <label for="endereco">üìç Endere√ßo de Entrega (√∫nico para todos os pedidos)</label>
  <input type="text" id="endereco" placeholder="Digite o endere√ßo de entrega">
</div>

<div id="taxaEntregaInfo">üìç Retirada no Local</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const localEntrega = document.getElementById("localEntrega");
  const enderecoContainer = document.getElementById("enderecoContainer");
  const enderecoInput = document.getElementById("endereco");
  const taxaEntregaInfo = document.getElementById("taxaEntregaInfo");

  function atualizarCampo() {
    const localEscolhido = localEntrega.value.toLowerCase();
    const taxa = parseFloat(localEntrega.selectedOptions[0]?.dataset.taxa || 0);

    if (localEscolhido === "retirada") {
      enderecoContainer.style.display = "none";
      enderecoInput.value = "üìç Retirada no Local";
      enderecoInput.readOnly = true;
      enderecoInput.required = false;
      enderecoInput.style.background = "#eee";
      taxaEntregaInfo.innerHTML = "üìç Pegar no Local";
    } else {
      enderecoContainer.style.display = "block";
      enderecoInput.value = "";
      enderecoInput.readOnly = false;
      enderecoInput.required = true;
      enderecoInput.style.background = "#fff";
      taxaEntregaInfo.innerHTML = `üèçÔ∏è Taxa de entrega: R$ ${taxa.toFixed(2)}`;
    }
  }

  atualizarCampo();
  localEntrega.addEventListener("change", atualizarCampo);
});
</script>















  <label for="pagamento">üí≥ Forma de Pagamento (√∫nica para todos)</label>
  <select id="pagamento">
    <option value="" disabled selected>Carregando op√ß√µes...</option>
  </select>

<div id="trocoContainer" style="display:none; margin-top:10px;">
  <label for="valorPago">üíµ Valor pago (Dinheiro)</label>
  <input type="number" id="valorPago" placeholder="Digite o valor pago" min="0" step="0.01">
  <p id="trocoInfo" style="margin-top:5px; font-weight:bold;"></p>
</div>







  <div id="pedidosContainer"></div>
<button id="adicionarPedido">‚ûïNovo Pedido</button>


  <h3>üìã Pedidos Selecionados</h3>
  <ul id="itensPedido">
    <li>Nenhum pedido adicionado</li>
  </ul>

  <button id="enviarWhats">üì≤ Enviar para WhatsApp e PDF</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// ========== DATA ==========
const diasSemana = ["Domingo","Segunda-feira","Ter√ßa-feira","Quarta-feira","Quinta-feira","Sexta-feira","S√°bado"];
const hojeDate = new Date();
document.getElementById("diaSemana").innerText = diasSemana[hojeDate.getDay()];
const dia = String(hojeDate.getDate()).padStart(2,'0');
const mes = String(hojeDate.getMonth()+1).padStart(2,'0');
const ano = hojeDate.getFullYear();
document.getElementById("dataHoje").innerText = `${dia}/${mes}/${ano}`;

// ========== VARI√ÅVEIS ==========
let pedidos = [];
let cardapioFinal = null;

// ========== FUN√á√ÉO ATUALIZAR PEDIDOS ==========
function atualizarPedido() {
  const itensEl = document.getElementById("itensPedido");
  if (pedidos.length === 0) {
    itensEl.innerHTML = "<li>Nenhum pedido adicionado</li>";
    return;
  }

  let html = "";
  let totalGeral = 0;
  const taxa = parseFloat(document.getElementById("localEntrega").selectedOptions[0]?.dataset.taxa || 0);

  pedidos.forEach((p, i) => {
    let subtotal = p.valorMarmita || 0;

    html += `<li><strong>Pedido ${i+1} - ${p.nome || "Cliente"}</strong><br>`;
    if (p.marmita) html += `üç± Marmita ${p.marmita} - R$${(p.valorMarmita||0).toFixed(2)}<br>`;
    if (p.carnes.length) html += `üçñ Carnes: ${p.carnes.join(", ")}<br>`;
    if (p.acompanhamentos.length) html += `ü•ó Acompanhamentos: ${p.acompanhamentos.join(", ")}<br>`;

    if (p.refrigerantes.length) {
      p.refrigerantes.forEach(r => {
        html += `ü•§ ${r.nome} x${r.qtd} - R$${(r.preco*r.qtd).toFixed(2)}<br>`;
        subtotal += r.preco*r.qtd;
      });
    }

    if (p.adicionais && p.adicionais.trim() !== "") {
      html += `üìù Adicionais: ${p.adicionais} - R$4.00<br>`;
      subtotal += 4.00;
    }

    if (p.observacao && p.observacao.trim() !== "") {
      html += `üí¨ Obs: ${p.observacao}<br>`;
    }

    html += `<strong>Subtotal: R$${subtotal.toFixed(2)}</strong></li>`;
    totalGeral += subtotal;
  });

  totalGeral += taxa;
  html += `<li><strong>Total Geral (com taxa R$${taxa.toFixed(2)}): R$${totalGeral.toFixed(2)}</strong></li>`;
  itensEl.innerHTML = html;
}

// ========== CARREGAR CARD√ÅPIO ==========
fetch('cardapio.json?t=' + new Date().getTime())
.then(res => res.json())
.then(data => {
  cardapioFinal = data;
  document.getElementById("horarioFuncionamento").textContent = 
    `Hor√°rio: ${data.horarioFuncionamento.abertura} - ${data.horarioFuncionamento.fechamento}`;

  // Locais
  const localSelect = document.getElementById("localEntrega");
  localSelect.innerHTML = '<option value="" disabled selected>Selecione o local</option>';
  data.locaisEntrega.forEach((loc) => {
    const opt = document.createElement("option");
    opt.value = loc.nome;
    opt.dataset.taxa = loc.taxa;
    opt.textContent = `${loc.nome} - R$${loc.taxa.toFixed(2)}`;
    localSelect.appendChild(opt);
  });



// Pagamento
const pagamentoSelect = document.getElementById("pagamento");
pagamentoSelect.innerHTML = '';
if (data.formasPagamento && Array.isArray(data.formasPagamento) && data.formasPagamento.length) {
  const defaultOpt = document.createElement('option');
  defaultOpt.value = '';
  defaultOpt.textContent = 'Selecione a forma de pagamento';
  defaultOpt.disabled = true;
  defaultOpt.selected = true;
  pagamentoSelect.appendChild(defaultOpt);

  data.formasPagamento.forEach(fp => {
    const o = document.createElement('option');
    o.value = fp;
    o.textContent = fp;
    pagamentoSelect.appendChild(o);
  });
} else {
  pagamentoSelect.innerHTML = `
    <option value="" disabled selected>Selecione a forma de pagamento</option>
    <option value="Dinheiro">Dinheiro</option>
    <option value="Pix">Pix</option>
    <option value="Cart√£o">Cart√£o</option>
  `;
}

const trocoContainer = document.getElementById("trocoContainer");
const valorPagoInput = document.getElementById("valorPago");
const trocoInfo = document.getElementById("trocoInfo");

// Fun√ß√£o para calcular o troco
function atualizarTroco() {
  const valorPago = parseFloat(valorPagoInput.value) || 0;
  const taxa = parseFloat(document.getElementById('localEntrega').selectedOptions[0]?.dataset.taxa || 0);

  let totalGeral = pedidos.reduce((total, p) => {
    let subtotal = p.valorMarmita || 0;
    if (p.refrigerantes) p.refrigerantes.forEach(r => subtotal += r.preco * r.qtd);
    if (p.adicionais) subtotal += 4.00;
    return total + subtotal;
  }, 0) + taxa;

  if (valorPago > 0) {
    const troco = valorPago - totalGeral;
    trocoInfo.textContent = troco >= 0
      ? `üí∞ Troco estimado: R$ ${troco.toFixed(2)}`
      : `üí∏ Falta: R$ ${Math.abs(troco).toFixed(2)}`;
  } else {
    trocoInfo.textContent = "";
  }
}

// Exibir troco apenas quando "Dinheiro" for selecionado
pagamentoSelect.addEventListener("change", () => {
  if (pagamentoSelect.value === "Dinheiro") {
    trocoContainer.style.display = "block";
    atualizarTroco();
  } else {
    trocoContainer.style.display = "none";
    trocoInfo.textContent = "";
  }
});

// Atualiza troco enquanto digita o valor pago
valorPagoInput.addEventListener("input", atualizarTroco);






 

// Atualiza taxa + endere√ßo quando muda local
localSelect.addEventListener('change', () => {
  const enderecoInput = document.getElementById("endereco");
  const enderecoContainer = document.getElementById("enderecoContainer");
  const taxa = parseFloat(localSelect.selectedOptions[0]?.dataset.taxa || 0);
  const localEscolhido = localSelect.value.toLowerCase();

  document.getElementById('taxaEntregaInfo').textContent = 
    `üèçÔ∏è Taxa de entrega: R$ ${taxa.toFixed(2)}`;

  if (localEscolhido.includes("retirada")) {
    // Retirada no local ‚Üí n√£o precisa de endere√ßo
    enderecoContainer.style.display = "none";
    enderecoInput.value = "Retirada no Local";
    enderecoInput.readOnly = true;
    enderecoInput.required = false;
    enderecoInput.style.background = "#eee";
  } else {
    // Entrega ‚Üí mostra campo endere√ßo
    enderecoContainer.style.display = "block";
    if (enderecoInput.value === "Retirada no Local") {
      enderecoInput.value = "";
    }
    enderecoInput.readOnly = false;
    enderecoInput.required = true;
    enderecoInput.style.background = "#fff";
  }

  atualizarPedido();
});

})
.catch(err=>{ console.error('Erro ao carregar cardapio.json', err); });






// ========== ADICIONAR PEDIDO ==========
document.getElementById("adicionarPedido").addEventListener("click", criarPedido);

function criarPedido() {
  if (!cardapioFinal) return alert("Aguarde o carregamento do card√°pio...");
  const index = pedidos.length;
  const pedidoObj = { 
    nome:"", 
    marmita:"", 
    carnes:[], 
    acompanhamentos:[], 
    refrigerantes:[], 
    adicionais:"", 
    valorAdicionais:0, 
    observacao:"",
    valorMarmita:0
  };
  pedidos.push(pedidoObj);

  const container = document.createElement("div");
  container.classList.add("pedido-individual");
  container.dataset.index = index;

  container.innerHTML = `
    <h4>Pedido da Pessoa ${index + 1}</h4>
    <label>üë§ Nome do Cliente:</label>
    <input type="text" class="nomeCliente" placeholder="Nome do cliente">
    <div class="marmita-options"><h4>üç± Tipo de Marmita</h4></div>
    <h4>üçñ Carnes</h4><ul class="carnes"></ul>
    <h4>ü•ó Acompanhamentos</h4><ul class="acompanhamentos"></ul>
    <h4>ü•§ Refrigerantes</h4><ul class="refrigerantes"></ul>
    <h4>Adicionais:</h4>
    <input type="text" class="adicionais" placeholder="Digite adicionais">
  `;

  document.getElementById("pedidosContainer").appendChild(container);

  // === NOVO: colocar foco no campo nome do cliente ===
container.querySelector(".nomeCliente").focus();

// === NOVO: rolar at√© o final do container geral ===
container.scrollIntoView({ behavior: "smooth", block: "end" });

 // Atualizar nome do cliente
  container.querySelector(".nomeCliente").addEventListener("input", e=>{
    pedidoObj.nome = e.target.value.trim();
    atualizarPedido();
  });
  

  // ========== CONFIGURAR MARMITA ==========
  let limiteCarnes = 0;
  const marmitaContainer = container.querySelector(".marmita-options");

  const hojeCardapio = cardapioFinal.cardapio[diasSemana[hojeDate.getDay()].toLowerCase()] || { carnes: [], acompanhamentos: [] };
  const acompanhamentosPadrao = {
    "01": hojeCardapio.acompanhamentos,
    "02": hojeCardapio.acompanhamentos
  };

  Object.keys(cardapioFinal.valoresMarmita).forEach(key => {
    const label = document.createElement("label");
    label.innerHTML = `<input type="radio" name="marmita${index}" value="${key}"> Marmita ${key} - R$${cardapioFinal.valoresMarmita[key]},00`;
    label.querySelector("input").addEventListener("change", () => {
      pedidoObj.marmita = key;
      pedidoObj.valorMarmita = cardapioFinal.valoresMarmita[key];

      limiteCarnes = key.includes("01") ? 1 : key.includes("02") ? 2 : 0;

      const acompLis = container.querySelectorAll(".acompanhamentos li");
      if (key.toLowerCase().includes("por√ß√£o")) {
        acompLis.forEach(li => {
          li.classList.remove("selected");
          li.style.pointerEvents = "none";
        });
        pedidoObj.acompanhamentos = [];
      } else {
        acompLis.forEach(li => {
          li.classList.toggle("selected", acompanhamentosPadrao[key]?.includes(li.dataset.item));
          li.style.pointerEvents = "auto";
        });
        pedidoObj.acompanhamentos = Array.from(acompLis).filter(li => li.classList.contains("selected")).map(li => li.dataset.item);
      }

      container.querySelectorAll(".carnes li").forEach(li => li.classList.remove("selected"));
      pedidoObj.carnes = [];
      atualizarPedido();
    });
    marmitaContainer.appendChild(label);
  });

  // ========== FUN√á√ÉO AUXILIAR PARA LISTAS ==========
  function criarLista(itens, ulContainer, tipo, unico = false) {
    ulContainer.innerHTML = "";
    itens.forEach(i => {
      const li = document.createElement("li");
      li.setAttribute("data-item", i);
      li.innerHTML = `<div class="checkbox-fake">‚úî</div><span>${i}</span>`;
      if (tipo === 'acompanhamentos') li.style.pointerEvents = 'none';
      li.addEventListener("click", () => {
        const selecionados = Array.from(ulContainer.querySelectorAll("li.selected"));
        if (tipo === "carnes" && !li.classList.contains("selected") && selecionados.length >= limiteCarnes) return;
        if (unico) ulContainer.querySelectorAll("li").forEach(l => l.classList.remove("selected"));
        li.classList.toggle("selected");
        pedidoObj[tipo] = Array.from(ulContainer.querySelectorAll("li.selected")).map(x => x.dataset.item);
        atualizarPedido();
      });
      ulContainer.appendChild(li);
    });
  }

  criarLista(hojeCardapio.carnes, container.querySelector(".carnes"), "carnes");
  criarLista(hojeCardapio.acompanhamentos, container.querySelector(".acompanhamentos"), "acompanhamentos");

  // ========== REFRIGERANTES COM QUANTIDADE ==========
  const refrigerantesHoje = [];
  Object.values(cardapioFinal.refrigerantes).forEach(tipo => 
    tipo.forEach(r => refrigerantesHoje.push({ nome: r.nome, preco: r.preco }))
  );

  function criarListaRefrigerantes(itens, ulContainer) {
    ulContainer.innerHTML = "";
    itens.forEach(i => {
      const li = document.createElement("li");
      li.dataset.item = i.nome;
      li.innerHTML = `
        <span>${i.nome} - R$${i.preco.toFixed(2)}</span>
        <div class="quantidade-container">
          <button type="button" class="menos">-</button>
          <input type="number" class="qtd" value="0" min="0" readonly>
          <button type="button" class="mais">+</button>
        </div>
      `;

      const qtdInput = li.querySelector(".qtd");
      const btnMenos = li.querySelector(".menos");
      const btnMais = li.querySelector(".mais");

      function atualizarQtd() {
        const qtd = parseInt(qtdInput.value);
        const existente = pedidoObj.refrigerantes.find(r => r.nome === i.nome);
        if (qtd > 0) {
          if (existente) {
            existente.qtd = qtd;
          } else {
            pedidoObj.refrigerantes.push({ nome: i.nome, qtd: qtd, preco: i.preco });
          }
        } else {
          pedidoObj.refrigerantes = pedidoObj.refrigerantes.filter(r => r.nome !== i.nome);
        }
        atualizarPedido();
      }

      btnMais.addEventListener("click", () => {
        qtdInput.value = parseInt(qtdInput.value) + 1;
        atualizarQtd();
      });

      btnMenos.addEventListener("click", () => {
        if (parseInt(qtdInput.value) > 0) {
          qtdInput.value = parseInt(qtdInput.value) - 1;
          atualizarQtd();
        }
      });

      ulContainer.appendChild(li);
    });
  }

  criarListaRefrigerantes(refrigerantesHoje, container.querySelector(".refrigerantes"));

  // ========== ADICIONAIS COM VALOR FIXO ==========
  const adicionaisInput = container.querySelector(".adicionais");
  adicionaisInput.addEventListener("input", () => {
    pedidoObj.adicionais = adicionaisInput.value.trim();
    pedidoObj.valorAdicionais = pedidoObj.adicionais ? 4.00 : 0.00;
    atualizarPedido();
  });

  // ========== OBSERVA√á√ÉO ==========
  const obsLabel = document.createElement("label");
  obsLabel.textContent = "üìå Observa√ß√£o:";
  const obsInput = document.createElement("textarea");
  obsInput.classList.add("observacao");
  obsInput.placeholder = "Digite alguma observa√ß√£o...";
  obsInput.addEventListener("input", () => {
    pedidoObj.observacao = obsInput.value.trim();
  });
  container.appendChild(obsLabel);
  container.appendChild(obsInput);
}




// ========== ENVIAR WHATSAPP E GERAR PDF ==========
document.getElementById("enviarWhats").addEventListener("click", () => {
  const endereco = document.getElementById("endereco").value.trim();
  let localNome = document.getElementById("localEntrega").value;
  const pagamentoGlobal = document.getElementById('pagamento').value;
  const taxa = parseFloat(document.getElementById('localEntrega').selectedOptions[0]?.dataset.taxa || 0);
  const valorPago = parseFloat(document.getElementById("valorPago")?.value) || 0;

  // Ajuste: se n√£o selecionar local ou taxa = 0, considerar Retirar no Local
  if (!localNome || taxa === 0) {
    localNome = "Retirar no Local";
  }

  if (taxa > 0 && !endereco) {
    return alert("Informe o endere√ßo de entrega.");
  }

  if (!pagamentoGlobal) return alert("Escolha a forma de pagamento.");
  if (pedidos.length === 0) return alert("Nenhum pedido adicionado.");

  const nomesClientes = pedidos.map(p => p.nome || "Cliente").join(", ");

  // ===== C√°lculo do total geral =====
  let totalGeral = pedidos.reduce((total, p) => {
    let subtotal = p.valorMarmita || 0;
    if (p.refrigerantes) p.refrigerantes.forEach(r => subtotal += r.preco * r.qtd);
    if (p.adicionais) subtotal += 4.00;
    return total + subtotal;
  }, 0) + taxa;

  // ===== C√°lculo do troco =====
  let trocoTexto = "";
  if (pagamentoGlobal === "Dinheiro" && valorPago > 0) {
    const troco = valorPago - totalGeral;
    trocoTexto = troco >= 0
      ? `üí∞ Troco estimado: R$ ${troco.toFixed(2)}`
      : `üí∏ Falta: R$ ${Math.abs(troco).toFixed(2)}`;
  }

// ===== WhatsApp =====
let taxaTexto = taxa > 0 
  ? `üèçÔ∏è Taxa de Entrega: R$${taxa.toFixed(2)}`
  : ""; // remove "Retirar no Local" daqui

let msg = `üçΩÔ∏è *Pedidos dos clientes: ${nomesClientes}*\nüìç Local: ${localNome}\n` +
          (taxa > 0 ? "üìç Endere√ßo: " + endereco + "\n" : "") +
          `üí≥ Pagamento: ${pagamentoGlobal}\n` +
          (taxaTexto ? taxaTexto + "\n" : "");

if (trocoTexto) {
  msg += `Valor do Troco : R$${trocoTexto.replace(/[^\d.,]/g, '')}\n`;
}

let totalWhats = 0;

pedidos.forEach((p, i) => {
  msg += `\nüìå Pedido ${i + 1} - ${p.nome || "Cliente"}\n`;
  let subtotal = p.valorMarmita || 0;

  if (p.marmita) msg += `üç± Marmita ${p.marmita} - R$${(p.valorMarmita || 0).toFixed(2)}\n`;
  if (p.carnes) p.carnes.forEach(c => msg += `üçñ ${c}\n`);
  if (p.acompanhamentos) p.acompanhamentos.forEach(a => msg += `ü•ó ${a}\n`);

  if (p.refrigerantes && p.refrigerantes.length) {
    p.refrigerantes.forEach(r => {
      msg += `ü•§ ${r.nome} x${r.qtd} - R$${(r.preco * r.qtd).toFixed(2)}\n`;
      subtotal += r.preco * r.qtd;
    });
  }

  if (p.adicionais && p.adicionais.trim() !== "") {
    msg += `üìù Adicionais: ${p.adicionais} - R$4.00\n`;
    subtotal += 4.00;
  }

  if (p.observacao && p.observacao.trim() !== "") {
    msg += `üí¨ Obs: ${p.observacao}\n`;
  }

  msg += `Subtotal: R$${subtotal.toFixed(2)}\n`;
  totalWhats += subtotal;
});

totalWhats += taxa;
msg += `\nüí∏ *TOTAL GERAL: R$${totalWhats.toFixed(2)}*`;

window.open(`https://wa.me/+556192633504?text=${encodeURIComponent(msg)}`, "_blank");




// ===== PDF SIMPLES =====
const { jsPDF } = window.jspdf;
const doc = new jsPDF({ orientation: 'portrait', unit: 'pt', format: [226, 1000] });
const t = texto => texto.normalize("NFC");
const larguraMax = 206;

// Cabe√ßalho
doc.setFont('helvetica', 'bold'); 
doc.setFontSize(14); 
doc.text(t('Restaurante Kolinas'), 113, 20, { align: 'center' });

const hoje = new Date();
const dia = String(hoje.getDate()).padStart(2, '0');
const mes = String(hoje.getMonth() + 1).padStart(2, '0');
const ano = hoje.getFullYear();

doc.setFont('helvetica', 'normal'); 
doc.setFontSize(10); 
doc.text(t(`Pedidos de ${dia}/${mes}/${ano}`), 113, 35, { align: 'center' });

let y = 55;
[
  `Local: ${localNome}`,
  taxa > 0 ? `Endere√ßo: ${endereco}` : null,
  `Pagamento: ${pagamentoGlobal}`,
  taxa > 0 ? `Taxa de entrega: R$${taxa.toFixed(2)}` : "Retirar no Local",
  trocoTexto ? trocoTexto.replace(/^üí∞\s*/, '') : null // <-- troco s√≥ aqui em cima
].forEach(texto => {
    if (texto) {
        const linhas = doc.splitTextToSize(t(texto), larguraMax);
        doc.text(linhas, 10, y);
        y += linhas.length * 10;
    }
});
y += 5;

let totalGeralPDF = 0;

pedidos.forEach((p, i) => {
    doc.setDrawColor(0);
    doc.setLineWidth(0.5);
    doc.line(10, y, 216, y);
    y += 8;

    doc.setFont('helvetica', 'bold');
    doc.setFontSize(10);
    doc.text(`Pedido ${i + 1} - ${p.nome || "Cliente"}`, 10, y);
    y += 12;

    let subtotal = p.valorMarmita || 0;
    const campos = [];

    if (p.marmita) campos.push({ titulo: 'Marmita:', valor: `${p.marmita} - R$${(p.valorMarmita || 0).toFixed(2)}` });
    if (p.carnes && p.carnes.length) campos.push({ titulo: 'Carnes:', valor: `${p.carnes.join(", ")}` });
    if (p.acompanhamentos && p.acompanhamentos.length) campos.push({ titulo: 'Acompanhamentos:', valor: `${p.acompanhamentos.join(", ")}` });

    if (p.refrigerantes && p.refrigerantes.length) {
        const bebidasText = p.refrigerantes.map(r => `${r.nome} x${r.qtd} - R$${(r.preco*r.qtd).toFixed(2)}`).join(", ");
        campos.push({ titulo: 'Bebidas:', valor: bebidasText });
        p.refrigerantes.forEach(r => subtotal += r.preco*r.qtd);
    }

    if (p.adicionais && p.adicionais.trim() !== "") {
        campos.push({ titulo: 'Adicionais:', valor: `${p.adicionais} - R$4.00` });
        subtotal += 4.00;
    }

    if (p.observacao && p.observacao.trim() !== "") {
        campos.push({ titulo: 'Observa√ß√£o:', valor: p.observacao });
    }

    campos.forEach(c => {
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(9);
        const linhas = doc.splitTextToSize(`${c.titulo} ${c.valor}`, larguraMax);
        doc.text(linhas, 10, y);
        y += linhas.length * 10;
    });

    doc.setFont('helvetica', 'bold');
    doc.setFontSize(10);
    doc.text(`Subtotal: R$${subtotal.toFixed(2)}`, 10, y);
    y += 15;

    totalGeralPDF += subtotal;
});

// Linha antes do total
doc.setDrawColor(0);
doc.setLineWidth(0.8);
doc.line(10, y, 216, y);
y += 12; // <-- mais espa√ßo antes do TOTAL GERAL

// Total Geral
totalGeralPDF += taxa;
doc.setFont('helvetica', 'bold');
doc.setFontSize(12);
doc.text(`TOTAL GERAL: R$${totalGeralPDF.toFixed(2)}`, 10, y);

doc.save('Pedidos.pdf');



});
  
</script>
</body>
</html>















