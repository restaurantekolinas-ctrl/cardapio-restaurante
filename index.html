<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Card√°pio Interativo</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; padding: 10px; }
.cardapio { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.2); max-width: 500px; width: 100%; margin-bottom: 20px; }
.logo-container { display: flex; align-items: center; justify-content: flex-start; margin-bottom: 20px; }
.logo-container img { height: 60px; margin-right: 15px; border-radius: 8px; }
.titulo-container h1 { font-size: 1.5rem; color: #007BFF; margin-bottom: 5px; }
.titulo-container h2 { font-size: 1.1rem; color: #555; font-weight: normal; }
.titulo-container h3 { font-size: 1rem; margin-bottom: 10px; color: #333; }
ul { list-style: none; padding: 0; }
li { margin: 5px 0; cursor: pointer; display: flex; align-items: center; padding: 6px 10px; border-radius: 8px; transition: background 0.2s; }
li:hover { background: #f0f0f0; }
.checkbox-fake { width: 22px; height: 22px; border: 2px solid #007BFF; display: flex; align-items: center; justify-content: center; margin-right: 10px; border-radius: 4px; font-weight: bold; color: #fff; background: #007BFF; opacity: 0; transition: opacity 0.2s, transform 0.2s; flex-shrink: 0; }
li.selected .checkbox-fake { opacity: 1; transform: scale(1.1); }
li span { flex: 1; }
#adicionais, input[type="text"], select { width: 100%; padding: 8px; margin-top: 8px; border-radius: 6px; border: 1px solid #ccc; }
#enviarWhats { margin-top: 12px; padding: 10px; background: #25D366; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1rem; }
label { display: block; margin-bottom: 6px; cursor: pointer; }
.marmita-options label { display: block; margin-bottom: 8px; cursor: pointer; }
.marmita-options input { margin-right: 8px; }
@media (max-width: 600px) { 
  .logo-container { flex-direction: column; align-items: center; text-align: center; } 
  .logo-container img { margin-right: 0; margin-bottom: 8px; height: 50px; } 
  .titulo-container h1 { font-size: 1.3rem; } 
  .titulo-container h2 { font-size: 1rem; } 
  #enviarWhats { font-size: 0.95rem; } 
}
</style>
</head>
<body>

<div class="cardapio">
  <div class="logo-container">
    <img src="logo.png" alt="Logo Restaurante">
    <div class="titulo-container">
      <h1>Restaurante Colinas</h1>
      <h2>üçΩÔ∏è Card√°pio de Hoje ‚Äì <span id="diaSemana"></span>, <span id="dataHoje"></span></h2>
      <h3 id="horarioFuncionamento">Hor√°rio: --:-- - --:--</h3>
    </div>
  </div>

  <div class="marmita-options">
    <h3>üç± Escolha o tipo de Marmita</h3>
  </div>

  <h3>üçñ Carnes</h3>
  <ul id="carnes"></ul>

  <h3>ü•ó Acompanhamentos</h3>
  <ul id="acompanhamentos"></ul>

  <h3>ü•§ Refrigerantes</h3>
  <ul id="refrigerantes"></ul>

  <h3>Adicionais:</h3>
  <input type="text" id="adicionais" placeholder="Digite adicionais">

  <div class="cliente-info">
    <label for="nomeCliente">Nome do Cliente:</label>
    <input type="text" id="nomeCliente" placeholder="Digite seu nome">
    <label for="enderecoCliente">Endere√ßo:</label>
    <input type="text" id="enderecoCliente" placeholder="Digite o endere√ßo de entrega">
  </div>

  <h3>üìç Local de Entrega</h3>
  <select id="localEntrega"></select>

  <h3>üí≥ Formas de Pagamento</h3>
  <ul id="formasPagamentoList"></ul>

  <button id="enviarWhats">Enviar via WhatsApp</button>

  <h3>üìã Pedido Selecionado</h3>
  <ul id="itensPedido"><li>Nenhum item selecionado</li></ul>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const diasSemana = ["Domingo","Segunda-feira","Ter√ßa-feira","Quarta-feira","Quinta-feira","Sexta-feira","S√°bado"];
const hojeDate = new Date();
const nomeDia = diasSemana[hojeDate.getDay()];
document.getElementById("diaSemana").innerText = nomeDia;
const dia = String(hojeDate.getDate()).padStart(2,'0');
const mes = String(hojeDate.getMonth()+1).padStart(2,'0');
const ano = hojeDate.getFullYear();
document.getElementById("dataHoje").innerText = `${dia}/${mes}/${ano}`;

fetch('cardapio.json?t=' + new Date().getTime())
  .then(response => response.json())
  .then(cardapioFinal => {
    document.getElementById("horarioFuncionamento").textContent = 
      `Hor√°rio: ${cardapioFinal.horarioFuncionamento.abertura} - ${cardapioFinal.horarioFuncionamento.fechamento}`;

    const marmitaOptions = document.querySelector(".marmita-options");
    let marmita = "", valorMarmita = 0, limiteCarnes = 0;
    let pedido = [], taxaEntrega = 0, pagamentoSelecionado = "";
    let refrigerantesSelecionados = [];

    Object.keys(cardapioFinal.valoresMarmita).forEach(key=>{
      const label = document.createElement("label");
      label.innerHTML = `<input type="radio" name="marmita" value="${key}"> Marmita ${key} - R$${cardapioFinal.valoresMarmita[key]},00`;
      label.querySelector('input').addEventListener("change", ()=>{
        marmita = key;
        valorMarmita = cardapioFinal.valoresMarmita[key];

        if (key.includes("01 Op√ß√£o")) limiteCarnes = 1;
        else if (key.includes("02 Op√ß√£o")) limiteCarnes = 2;
        else limiteCarnes = 0;

        document.querySelectorAll("#carnes li").forEach(li=>li.classList.remove("selected"));
        pedido = pedido.filter(item => !cardapioFinal.cardapio[nomeDia.toLowerCase()].carnes.includes(item));

        const acompanhamentosContainer = document.getElementById("acompanhamentos");
        if (key.includes("Por√ß√£o")) {
          acompanhamentosContainer.querySelectorAll("li").forEach(li=>{
            li.classList.remove("selected");
            li.style.pointerEvents = "none";
            li.style.opacity = "0.5";
          });
          pedido = pedido.filter(item => !cardapioFinal.cardapio[nomeDia.toLowerCase()].acompanhamentos.includes(item));
        } else {
          acompanhamentosContainer.querySelectorAll("li").forEach(li=>{
            li.style.pointerEvents = "auto";
            li.style.opacity = "1";
          });
        }

        atualizarPedido();
      });
      marmitaOptions.appendChild(label);
    });

    function criarLista(itens, container, tipo="normal") {
      container.innerHTML = "";
      itens.forEach(i=>{
        const li = document.createElement("li");
        li.setAttribute("data-item", i);
        li.innerHTML = `<div class="checkbox-fake">X</div><span>${i}</span>`;
        if(tipo !== "carnes") {
          li.classList.add("selected");
          if(!pedido.includes(i)) pedido.push(i);
        }
        li.addEventListener("click", ()=>{
          if(tipo==="carnes"){
            const selecionadas = container.querySelectorAll("li.selected");
            if(!li.classList.contains("selected") && selecionadas.length >= limiteCarnes) return;
          }
          li.classList.toggle("selected");
          const item = li.getAttribute("data-item");
          if(li.classList.contains("selected")){
            if(!pedido.includes(item)) pedido.push(item);
          } else pedido = pedido.filter(x=>x!==item);
          atualizarPedido();
        });
        container.appendChild(li);
      });
    }

    function criarListaRefrigerantes(itens, container){
      container.innerHTML = "";
      itens.forEach(i=>{
        const li = document.createElement("li");
        li.setAttribute("data-item", i);
        li.innerHTML = `<div class="checkbox-fake">X</div><span>${i}</span>`;
        li.addEventListener("click", ()=>{
          li.classList.toggle("selected");
          const item = li.getAttribute("data-item");
          const preco = parseFloat(item.split('R$')[1]) || 0;
          if(li.classList.contains("selected")){
            refrigerantesSelecionados.push({nome: item, preco});
            if(!pedido.includes(item)) pedido.push(item);
          } else {
            refrigerantesSelecionados = refrigerantesSelecionados.filter(r => r.nome !== item);
            pedido = pedido.filter(x=>x!==item);
          }
          atualizarPedido();
        });
        container.appendChild(li);
      });
    }

    const hojeCardapio = cardapioFinal.cardapio[nomeDia.toLowerCase()] || { carnes: [], acompanhamentos: [] };
    criarLista(hojeCardapio.acompanhamentos, document.getElementById("acompanhamentos"), "acompanhamentos");
    criarLista(hojeCardapio.carnes, document.getElementById("carnes"), "carnes");
    criarListaRefrigerantes(
      Object.entries(cardapioFinal.refrigerantes).flatMap(([tipo, list]) => list.map(r=>`${tipo} - ${r.nome} R$${r.preco}`)),
      document.getElementById("refrigerantes")
    );

    const localEl = document.getElementById("localEntrega");
    cardapioFinal.locaisEntrega.forEach((loc,i)=>{
      const opt = document.createElement("option");
      opt.value = loc.nome;
      opt.dataset.taxa = loc.taxa;
      opt.textContent = `${loc.nome} - R$${loc.taxa.toFixed(2)}`;
      if(i===0) taxaEntrega = loc.taxa;
      localEl.appendChild(opt);
    });
    localEl.addEventListener("change", ()=>{ taxaEntrega = parseFloat(localEl.selectedOptions[0].dataset.taxa); atualizarPedido(); });

    const formasEl = document.getElementById("formasPagamentoList");
    cardapioFinal.formasPagamento.forEach(f=>{
      const li = document.createElement("li");
      li.innerHTML = `<div class="checkbox-fake">X</div><span>${f}</span>`;
      li.addEventListener("click", ()=>{
        formasEl.querySelectorAll("li").forEach(l=>l.classList.remove("selected"));
        li.classList.add("selected");
        pagamentoSelecionado = f;
        atualizarPedido();
      });
      formasEl.appendChild(li);
    });

    function atualizarPedido(){
      const adicionais = document.getElementById("adicionais").value;
      const totalRef = refrigerantesSelecionados.reduce((sum,r)=>sum+r.preco,0);
      const total = valorMarmita + taxaEntrega + totalRef;

      const itensEl = document.getElementById("itensPedido");
      itensEl.innerHTML = `
        ${marmita?`<li>üç± Marmita ${marmita} - R$${valorMarmita}</li>`:""}
        ${pedido.length?pedido.map(i=>`<li>‚úÖ ${i}</li>`).join(""):"<li>Nenhum item selecionado</li>"}
        ${adicionais?`<li>üìù ${adicionais}</li>`:""}
        ${pagamentoSelecionado?`<li>üí≥ Pagamento: ${pagamentoSelecionado}</li>`:""}
        <li>üèçÔ∏è Taxa de Entrega: R$${taxaEntrega.toFixed(2)}</li>
        <li>üí∞ Total: R$${total.toFixed(2)}</li>
      `;
    }

    // --------- Aqui est√° a corre√ß√£o do bot√£o ---------
  document.getElementById("enviarWhats").addEventListener("click", () => {
    const agora = new Date();
    const horas = agora.getHours();
    const minutos = agora.getMinutes();
    const agoraMinutos = horas * 60 + minutos;

    const [horaAbertura, minAbertura] = cardapioFinal.horarioFuncionamento.abertura.split(":").map(Number);
    const [horaFechamento, minFechamento] = cardapioFinal.horarioFuncionamento.fechamento.split(":").map(Number);
    const aberturaMinutos = horaAbertura * 60 + minAbertura;
    const fechamentoMinutos = horaFechamento * 60 + minFechamento;

    if (agoraMinutos < aberturaMinutos || agoraMinutos > fechamentoMinutos) {
        alert(`Desculpe! Pedidos s√≥ podem ser feitos entre ${cardapioFinal.horarioFuncionamento.abertura} e ${cardapioFinal.horarioFuncionamento.fechamento}.`);
        return;
    }

    const nome = document.getElementById("nomeCliente").value || "Cliente";
    const endereco = document.getElementById("enderecoCliente").value || "N√£o informado";
    const adicionais = document.getElementById("adicionais").value || "";
    const local = document.getElementById("localEntrega").value;
    const pagamento = pagamentoSelecionado || "N√£o definido";

    const totalRef = refrigerantesSelecionados.reduce((sum,r)=>sum+r.preco,0);
    const total = valorMarmita + taxaEntrega + totalRef;

    // ---------- Montar mensagem WhatsApp com emojis ----------
    let msg = `üçΩÔ∏è *Pedido de ${nome}*\n`;
    msg += `üìç Endere√ßo: ${endereco}\n`;
    msg += `üè† Local: ${local}\n\n`;
    msg += `üìã *Itens do Pedido:*\n`;
    if(marmita) msg += `üç± Marmita ${marmita} - R$${valorMarmita}\n`;
    pedido.forEach(i => msg += `‚úÖ ${i}\n`);
    refrigerantesSelecionados.forEach(r => msg += `ü•§ ${r.nome} - R$${r.preco}\n`);
    if(adicionais) msg += `üìù ${adicionais}\n`;
    msg += `üí≥ Pagamento: ${pagamento}\n`;
    msg += `üèçÔ∏è Taxa de Entrega: R$${taxaEntrega.toFixed(2)}\n`;
    msg += `üí∞ Total: R$${total.toFixed(2)}`;

    // Abrir WhatsApp com a mensagem
    window.open(`https://wa.me/+556192633504?text=${encodeURIComponent(msg)}`, "_blank");

    // ---------- Gerar PDF sem emojis ----------
    // ---------- Gerar PDF sem emojis, mas com formata√ß√£o melhor ----------
const { jsPDF } = window.jspdf;
const doc = new jsPDF();

// Cabe√ßalho
doc.setFontSize(18);
doc.setFont("helvetica", "bold");
doc.text("Restaurante Colinas", 10, 15);
doc.setFontSize(12);
doc.setFont("helvetica", "normal");

// Dados do cliente
doc.text(`Cliente: ${nome}`, 10, 25);
doc.text(`Endere√ßo: ${endereco}`, 10, 32);
doc.text(`Local de entrega: ${local}`, 10, 39);

// Separador
doc.setLineWidth(0.5);
doc.line(10, 44, 200, 44);

// Itens do pedido
doc.setFont("helvetica", "bold");
doc.text("Itens do Pedido:", 10, 50);
doc.setFont("helvetica", "normal");

let y = 57;
if(marmita){ doc.text(`Marmita ${marmita} - R$${valorMarmita}`, 12, y); y+=7; }
pedido.forEach(i => { doc.text(`${i}`, 12, y); y+=7; });
refrigerantesSelecionados.forEach(r => { doc.text(`${r.nome} - R$${r.preco}`, 12, y); y+=7; });
if(adicionais){ doc.text(`Adicionais: ${adicionais}`, 12, y); y+=7; }

// Separador antes do total
doc.line(10, y, 200, y); y += 5;

// Pagamento e taxa
doc.text(`Pagamento: ${pagamento}`, 10, y); y+=7;
doc.text(`Taxa de Entrega: R$${taxaEntrega.toFixed(2)}`, 10, y); y+=7;

// Total destacado
doc.setFont("helvetica", "bold");
doc.setFontSize(14);
doc.text(`TOTAL: R$${total.toFixed(2)}`, 10, y);

// Abrir PDF em nova aba
const pdfBlob = doc.output('blob');
const pdfURL = URL.createObjectURL(pdfBlob);
window.open(pdfURL, "_blank");

});

  });
</script>
</body>
</html>





